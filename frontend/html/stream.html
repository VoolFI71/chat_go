<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Screen Broadcast</title>
</head>
<body>
    <h1>WebRTC Screen Broadcast</h1>
    <button id="start">Start Screen Broadcast</button>
    <script>
        const startButton = document.getElementById('start');
        let pc;
        let ws;

        startButton.onclick = async () => {
            ws = new WebSocket('ws://localhost:8080/ws');

            ws.onopen = async () => {
                pc = new RTCPeerConnection();

                // Получите медиа-данные с экрана
                try {
                    const stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });
                    stream.getTracks().forEach(track => pc.addTrack(track, stream));

                    const offer = await pc.createOffer();
                    await pc.setLocalDescription(offer);

                    // Отправьте предложение на сервер
                    ws.send(JSON.stringify({ type: 'offer', sdp: offer.sdp }));

                    // Обработайте ICE кандидаты
                    pc.onicecandidate = (event) => {
                        if (event.candidate) {
                            ws.send(JSON.stringify({ type: 'candidate', candidate: event.candidate }));
                        }
                    };
                } catch (err) {
                    console.error("Error accessing display media.", err);
                }
            };

            ws.onmessage = (event) => {
                const message = JSON.parse(event.data);
                console.log("Received message:", message);
            };
        };
    </script>
</body>
</html>
